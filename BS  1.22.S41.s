10000 SYS7*4096:.OPT OO

10005 *=$33C:Z0 =$FC:Z1 =$FE

10010 LDY #0:STY Z0:LDX #$20

10020 LDA #$E0:STA Z0+1

10040 L1 LDA (Z0),Y:STA (Z0),Y

10050 INY:BNE L1:INC Z0+1

10060 DEX:BNE L1

10070 LDA #$A0:STA Z0+1:LDX #$20

10080 L2 LDA (Z0),Y:STA (Z0),Y

10090 INY:BNE L2:INC Z0+1

10092 DEX:BNE L2:RTS

10099 .END

10100 SYS828

10110 SYS7*4096:.OPT OO

11000 FLAG =$0298

11005 ACIA =$D600

11010 SERI2 =$029B:SERI1 =$029C

11020 SERO2 =$029E:SERO1 =$029D

11030 SERST =$0297

19999 ;********************************

20000 ;--------------------------------

20005 ;AENDERUNGEN AM ROM

20010 ;--------------------------------

20045 ;FARBE FUER CLR/HOME HINTERGRUND

20050 *=$E4DA : LDA $0286

20060 *=$FDE7 : LDA #45; CURSOR SPEED

21000 ;********************************

21005 ;--------------------------------

21010 ;        RS 232 PER ACIA

21020 ;--------------------------------

21021 ; BELEGT     $F014-$F0AC

21022 ;            $F409-$F49D

21023 ;--------------------------------

21030 ;-------OPEN

21040 *=$F409: RSOPEN

21050 LDY #0:STY SERST:RS0 CPY $B7

21060 BEQ RS1:LDA ($BB),Y:STA $0293,Y

21070 INY:CPY #$04:BNE RS0

21080 RS1 LDA $0293:ORA #16:SEI

21090 STA ACIA+1:STA ACIA+3

21100 LDA $0294:AND #$F0:ORA #$07

21110 STA ACIA+2

21120 LDA ACIA+1

21130 LDA #0:STA $02A1:CLI

21140 JSR $FE27:LDA $F8:BNE RS2:DEY

21150 STY $F8:STX $F7

21160 RS2 LDA $FA:BNE RS3:DEY

21170 STY $FA:STX $F9

21180 RS3 SEC:LDA #$F0:JMP $FE2D

21190 ;-------- RESET

21200 RSRESET SEI:LDA #2:STA ACIA+1

21210 STA ACIA+2:CLI:RTS

21220 ;-------- BASIN

21230 RSBASIN LDA SERST:LDY SERI1

21240 CPY SERI2:BEQ RSBIE:AND #$F7

21250 STA SERST:LDA ($F7),Y

21260 INC SERI1:PHA

21270 LDA $0294:AND #1:BEQ RSBI1

21280 LDA SERI1:SEC:SBC SERI2

21290 CMP #$C0:BCC RSBI1

21300 LDA ACIA+2:AND #$F3:ORA #$04

21310 STA ACIA+2:RSBI1 PLA:CLC:RTS

21320 RSBIE ORA #$08:STA SERST:LDA #0

21330 RTS

21340 ;-------- CLOSE

21350 *=$F2AF:JSR RSRESET

21360 *=$F2C5:JMP RS3

21370 ;-------- CHKIN

21380 *=$F227:JMP RSCHKIN

21390 ;-------- CHKOUT

21400 *=$F26C:JMP RSCKOUT

21410 ;-------- BSOUT

21420 *=$F014:NOP:NOP:NOP

21430 RSBSOUT LDY SERO2:INY:CPY SERO1

21440 BEQ RSBSOUT:STY SERO2:DEY

21450 LDA $9E:STA ($F9),Y:CRTS CLC:RTS

21460 ;-------- IRQ

21470 RSIR1 TAX

21480 LDA SERST:AND #$0C:STA SERST

21490 TXA:AND #$63:ORA SERST:STA SERST

21500 ;----

21510 TXA:AND #%00001000:BEQ SI3

21520 LDA ACIA:LDY SERI2:STA ($F7),Y

21530 INY:LDA SERST

21540 CPY SERI1:BNE SI2

21550 ORA #4:STA SERST

21560 SI2 STY SERI2

21570 ;----

21580 LDA $0294:AND #1:BEQ SI3

21590 LDA SERI1:SEC:SBC SERI2;=FREI

21600 CMP #$40:BCS SI3; MEHR ALS 1/4

21610 LDA ACIA+2:AND #$F3:STA ACIA+2

21620 ;----

21630 SI3 TXA:AND #%00010000:BEQ SI6

21640 LDY SERO1:CPY SERO2:BEQ SI6

21650 LDA ($F9),Y:JMP SII

21660 ;----: JMP RSBASIN ;(*=F086)

21670 SII STA ACIA:INY

21680 STY SERO1

21690 ;----

21700 SI6 LDA ACIA+1:RTS

21710 ;----

21720 RSIRQ LDA ACIA+1:BPL RSIR2

21730 JSR RSIR1:JMP $EA81

21740 RSIR2 JMP RSIR3:NOP:NOP:RTS; F0A4

21749 RSIR3 JSR $FFEA:JMP $EA34

21750 ;-------- CHKIN/CKOUT

21760 RSCHKIN STA $99:CLC:RTS

21770 RSCKOUT STA $9A:CLC:RTS

21775 ;--------------------------------

21780 ;-------- NMIOUT ADRS

21790 *=$ED0E:NOP:NOP:NOP

21800 *=$F88A:NOP:NOP:NOP

21810 ;-------- NMI-EINSPRUNG LOESCHEN

21820 *=$FE54:NOP:NOP

21830 *=$FE72:JMP $FEB6

21840 ;-------- IRQ SETZEN

21850 *=$EA31:JMP RSIRQ

21860 ;********************************

22000 ;-------------------------------

22010 *=$E1E6:JSR LSP; LOAD/SAVE IM DIR

22020 *=$E1DB:LDY #1:JSR LSD;

22030 *=$E5E7:JSR KEY; F-TASTEN

22040 *=$ECE7 ; SHIFT RUN/STOP

22050 .BYT "L","Ï",34,"*"

22060 *=$E455:LDA TTAB,X;BASIC-VEKTOREN

22099 ;--------------------------------

22100 *=$EEBB

22101 LSD STY $B9:JMP TSTBA

22105 LSP JSR $0079:CMP #",":BEQ LSP1

22107 LDY #1:STY $B9:JSR TSTBA

22110 PLA:PLA:JMP $A8F8:LSP1 RTS

22200 KEY JSR $E5B4:BIT FLAG:BMI LSP1

22210 CMP #141:BCS LSP1

22220 CMP #133:BCC LSP1

22230 SBC #133:TAY:LDX KEY1,Y:LDY #1

22240 K1 LDA KT,X:BEQ K2

22250 KTX STA $0276,Y:INY:INX:BNE K1

22260 K2 STY $C6:PLA:PLA:JMP $E5CD

22270 KEY1 .BYT 0,KT3-KT,KT5-KT,KT7-KT

22275 .BYT KT2-KT,KT4-KT,KT6-KT,KT8-KT

22280 KT  .ASC "LIST":.BYT 13,0

22281 KT3 .ASC "RUN:":.BYT 13,0

22282 KT5 .ASC "LOAD":.BYT 13,0

22283 KT7 .ASC ">$0":.BYT 13,0

22284 KT2 .ASC "‰":.BYT 0

22285 KT4 .ASC "_":.BYT 13,0

22286 KT6 .ASC "SAVE":.BYT 0

22287 KT8 .ASC "Œ":.BYT 0

22290 TTAB .WORD $E38B,$A483,NEUBEF

22295 .WORD $A71A,$A7E4,GETAUS

22300 GETAUS LDA #0:STA $0D

22310 JSR $0073:CMP #"$":BEQ GTA1

22320 CMP #"%":BEQ GTA2:JSR $0079

22330 JMP $AE8D

22340 GTA2 LDA #0:STA $63:STA $62

22350 GTA2A JSR $0073:BCS GTAE

22360 CMP #"2":BCS GTAERR

22370 LSR:ROL $63:ROL $62:BCC GTA2A

22380 GTAERR JMP $B248 ; ILL. QUANTITY

22390 GTA1 LDA #0:STA $63:STA $62

22400 GTA1A JSR $0073:SEC:SBC #"0"

22410 BCC GTAE:CMP #10:BCC GTA1O

22420 SBC #"A"-"9"-1:CMP #10:BCC GTAE

22430 CMP #16:BCS GTAERR

22440 GTA1O PHA:LDY #4:GTA3

22450 ASL $63:ROL $62:BCS GTAERR

22460 DEY:BNE GTA3:PLA:ORA $63:STA $63

22470 JMP GTA1A

22480 GTAE LDX #$90:SEC:JSR $BC49

22490 JMP $0079

22500 NEUBEF LDA $0200

22510 CMP #"@":BEQ NBA1:CMP #">"

22520 BEQ NBA1:CMP #"!":BEQ NBA2

22530 CMP #"_":BEQ SYSOFF:JMP $A57C

22540 NBA2 LDA #1:TAY:STA ($2B),Y

22550 JSR $A533:LDA $22:CLC:ADC #2

22560 STA $2D:LDA $23:ADC #0:STA $2E

22570 JSR $A663:JMP $E386

22580 NBA1 JSR $0073:BCC NBZ1:JMP NB1F

22581 NBZ1 JSR $B79E:TXA:AND #15

22582 STA FLAG:JMP NBA1E

22600 SYSOFF LDX #$0B

22610 SO1 LDA $E447,X:STA $0300,X

22620 DEX:BPL SO1:LDA FLAG

22630 ORA #128:STA FLAG:JMP NBA1E

22700 TSTBA

22705 LDA FLAG:AND #15:STA $BA:TST1 RTS

22710 NRESET LDA #8:STA FLAG

22715 LDA #128:STA 650

22720 LDA #2:STA ACIA+2

22725 JMP $FF6E

22990 ;--------------------------------

22995 *=$FDF6:JSR NRESET

22999 ;--------------------------------

23000 *=$FE75:NB1F JSR TSTBA

23005 LDA #0:STA $90:LDA $BA:JSR $FFB1

23010 LDA $0201:CMP #"$":BNE NB1C

23015 LDA #$F0:.BYT $2C

23020 NB1C LDA #$FF:JSR $FF93

23025 LDA $90:BMI NBA1E

23030 LDY #0:NBA1A LDA $0201,Y:BEQ NB1E

23035 JSR $FFA8:INY:BNE NBA1A

23040 NB1E JSR $FFAE:LDA $90:BNE NBA1E

23045 LDA $BA:JSR $FFB4

23050 LDA $0201

23055 CMP #"$":JMP NB1G

23057 ;--------------------------------

23058 *=$FEC2

23060 NB1G BEQ NB1D:LDA #$FF

23063 JSR $FF96

23065 NB1B JSR $FFA5:JSR $E716:LDA $90

23070 BEQ NB1B:NBDE JSR $FFAB

23075 NBA1E PLA:PLA:JMP $E386

23085 NB1D LDA #$F0:JSR $FF96

23090 JSR $FFA5:JSR $FFA5

23095 NBDL JSR $FFA5:JSR $FFA5

23100 LDX $90:BNE EDL3

23105 JSR $FFA5:TAX:JSR $FFA5:JSR $BDCD

23110 EDL1 JSR $FFA5:LDX $90:BNE EDL2

23115 JSR $E716:CMP #0

23120 BNE EDL1

23125 EDL2 LDA #13:JSR $E716

23130 JSR $FFE4:BNE EDL3

23135 LDA $90:BEQ NBDL:EDL3 JSR $FFAB

23140 LDA $BA:JSR $FFB1:LDA #$E0

23145 JSR $FF93:JSR $FFAE:JMP NBA1E

29990 ;******** LEERE BEREICHE LOESCHEN

49999 ;*******************************

50000 .END

50010 END

50020 OPEN2,2,2,CHR$(6)+CHR$(16)

50030 GET#2,A$:PRINTA$;

50040 GETA$:PRINT#2,A$;

50050 A=ST:IF (AAND247) <>0 THEN PRINTA

50060 IF A$<>"_" THEN50030

50070 CLOSE2

